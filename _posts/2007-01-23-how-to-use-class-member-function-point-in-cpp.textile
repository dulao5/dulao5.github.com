---
layout: post
title: 原来C＋＋支持 类成员函数指针
category: note
---

<span style="font-size: 13px;">
<div class="smalltxt" style="font-weight: bold; margin-left: 2em; margin-right: 2em;">
<div style="float: left;">CODE:</div>
</div>
<div id="code0" class="altbg2" style="clear: both; padding-right: 10px; padding-left: 10px; padding-bottom: 10px; margin: 3px 2em 2em; padding-top: 5px; font-family: fixedsys; border: #698cc3 1px solid;">#include <iostream>
using namespace std;

class A;
typedef void (A::*pAFun)(void);&nbsp;&nbsp;//定义类成员函数指针

class A{

public:
&nbs void fun(){
&nbs&nbsp; &nbsp;&nbsp;&nbsp;cout<<"A::fun run"<<endl;
&nbs };
};

class B
{
protected:
&nbs A *_a;
&nbs pAFun _callback;

public:
&nbs B():_callback(NULL), _a(NULL)
&nbs {};
&nbsp;&nbsp;
&nbs void setOnDo(pAFun _pf_callback, A * pA)
&nbs {
&nbs&nbsp; &nbsp;&nbsp;&nbsp;_callback = _pf_callback;
&nbs&nbsp; &nbsp;&nbsp;&nbsp;_a = pA;
&nbs }
&nbs 
&nbs void Do()
&nbs {
&nbs&nbsp; &nbsp;&nbsp;&nbsp;cout << "class B::Do ..." <<endl;
&nbs&nbsp; &nbsp;&nbsp;&nbsp;cout << "class B::Do callback: ..." <<endl;
&nbs&nbsp; &nbsp;&nbsp;&nbsp;if(_callback && _a)
&nbs&nbsp; &nbsp;&nbsp;&nbsp;{
&nbs&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;(_a->*_callback)();&nbsp;&nbsp;//以一种奇怪的方式进行&ldquo;类成员函数指针&rdquo;的调用
&nbs&nbsp; &nbsp;&nbsp;&nbsp;}
&nbs&nbsp; &nbsp;&nbsp;&nbsp;cout << "class B::Do return" <<endl;
&nbs }
&nbs 
};

int main(int argc, char *argv[])
{
&nbs A a;
&nbs B b;

&nbs b.setOnDo(&A::fun, &a);

&nbs b.Do();

&nbs return 0;
}</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 刚刚写代码验证的，做个记号。</span><span style="font-size: small;"> </span>

