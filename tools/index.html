<!DOCTYPE html>
<html>
<head>
  <title>BookMarklets</title>
  <meta charset="UTF-8"/>
</head>
<body>

<h3>Jira Command</h3>
  ＊ source : <a href="https://gist.github.com/dulao5/d54c70551ee0a1b350e9#file-jiracmd-js">gist</a><br/>
  ＊ BookMarklet : <a href='javascript:(function(){var csv_paths=[];csv_paths.push(".issue-body-content #descriptionmodule .user-content-block > p:contains(CSV) + UL");csv_paths.push(".issue-body-content #descriptionmodule .user-content-block > h3:contains(CSV) + UL");csv_paths.push(".issue-body-content #descriptionmodule .user-content-block > ul > li:contains(csv) + UL");csv_paths.push(".issue-body-content #descriptionmodule .user-content-block > p:contains(import) + UL");csv_paths.push(".issue-body-content #descriptionmodule .user-content-block ul > li:contains(csv) > ul");function get_tables_by_text(text){return text.split(/\r\n?|\n/).map(function(txt){return txt.replace(/\s*/g,"")}).filter(function(i){return i!=""})}function get_tables_by_path(path){var arr=$(path);if(arr.length>0){return get_tables_by_text(arr[arr.length-1].textContent);}else{return [];}}function get_tables_by_paths(paths){for(var i=0;i<paths.length;i++){var tables=get_tables_by_path(paths[i]);if(tables.length)return tables;}return []}function make_commands(){var now=(new Date());var datetime=(now.toLocaleDateString()+"_"+now.toLocaleTimeString()).replace(/[^\d]/g,"_").replace(/_+/g,"_").replace(/^_|_$/,"");var cmds="";var csvs=get_tables_by_paths(csv_paths);if(csvs.length){cmds+="bundle exec cap production data:import_master tables="+csvs.join(",")+" 2>&1 |tee /tmp/import_"+datetime+".log\n\n";}cmds+="bundle exec cap production data:update_resource"+" 2>&1 |tee /tmp/update_resource_"+datetime+".log\n\n";cmds+="grep 'path: \\[' /tmp/update_resource_"+datetime+".log |sed -e 's/.*path: \\[ =>//' -e 's/\\].*//'";if(cmds){return "手順です:\n{code}\n"+cmds+"\n\n#確認してもらいます\n\nbundle exec cap production util:clear_sendfile\n"+"{code}\n"}else{return ""}}var cmd=make_commands();if(cmd){alert(cmd)}else{alert("csv/resource情報が取れません")}})()'>
      JiraCMD</a>
    <br/>
  ＊ <a href="http://subsimple.com/bookmarklets/jsbuilder.htm">Bookmarklet Builder</a>
</body>
</html>
